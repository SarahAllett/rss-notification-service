FROM node:10.12.0-alpine

ARG AWS_DYNAMODB_ENDPOINT
ARG AWS_DYNAMODB_REGION
ARG AWS_SES_ENDPOINT
ARG AWS_SES_FROM_EMAIL
ARG AWS_SES_REGION
ARG MC_API_KEY
ARG NODE_ENV=production
ARG AWS_ACCESS_ID
ARG AWS_SECRET_KEY

WORKDIR /rss-notification-service

ADD . /rss-notification-service

ENV AWS_DYNAMODB_ENDPOINT $AWS_DYNAMODB_ENDPOINT
ENV AWS_DYNAMODB_REGION $AWS_DYNAMODB_REGION
ENV AWS_SES_ENDPOINT $AWS_SES_ENDPOINT
ENV AWS_SES_FROM_EMAIL $AWS_SES_FROM_EMAIL
ENV AWS_SES_REGION $AWS_SES_REGION
ENV MC_API_KEY $MC_API_KEY
ENV NODE_ENV $NODE_ENV
ENV AWS_ACCESS_ID $AWS_ACCESS_ID
ENV AWS_SECRET_KEY $AWS_SECRET_KEY

RUN echo "Environment: (NODE_ENV): $NODE_ENV" && npm install

HEALTHCHECK --interval=5s --timeout=3s CMD node healthcheck.js

CMD [ "npm", "start" ]
